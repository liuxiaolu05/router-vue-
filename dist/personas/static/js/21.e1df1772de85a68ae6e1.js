webpackJsonp([21],{Hv9Z:function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"sale-situation",attrs:{id:"category"}},[e("div",{staticClass:"sale-top box-bot title-box"},[e("div",{staticClass:"title i-pull-clear"},[e("div",{staticClass:"i-pull-left"},[e("span",{staticClass:"title-name",domProps:{textContent:t._s(t.villageName)}})]),t._v(" "),e("div",{staticClass:"i-pull-right btn-right"},[e("Button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回数据分析列表")])],1)]),t._v(" "),e("div",{staticClass:"box-content sale-form"},[e("div",{staticClass:"form-condition self-btn-ghost",attrs:{id:"form-btn"}},[e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.dailyHigh},attrs:{type:"button"},on:{click:function(a){t.daily("day")}}},[e("span",[t._v("日报")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.weeklyHigh},attrs:{type:"button"},on:{click:function(a){t.daily("week")}}},[e("span",[t._v("周报")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.monthlyHigh},attrs:{type:"button"},on:{click:function(a){t.daily("month")}}},[e("span",[t._v("月报")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.yearlyHigh},attrs:{type:"button"},on:{click:function(a){t.daily("year")}}},[e("span",[t._v("年报")])])])]),t._v(" "),e("div",{staticClass:"date-component"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.dailyHigh,expression:"dailyHigh"}],staticClass:"daily form-condition self-btn-ghost  "},[e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.date.seven},attrs:{type:"button"},on:{click:function(a){t.timeChange("7")}}},[e("span",[t._v("最近7天")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.date.thirty},attrs:{type:"button"},on:{click:function(a){t.timeChange("30")}}},[e("span",[t._v("最近30天")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.date.zero},attrs:{type:"button"},on:{click:function(a){t.timeChange()}}},[e("span",[t._v("自定义时段")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("div",{staticClass:"form-group",attrs:{id:"tip-date"}},[e("Date-picker",{staticStyle:{width:"200px"},attrs:{format:"yyyy.MM.dd",confirm:"",value:t.date.day,type:"daterange",disabled:t.date.timeFlag,options:t.date.dateValue,placement:"bottom-start",id:"picker",placeholder:"选择日期",open:t.open},on:{"on-change":t.dateTime,"on-clear":t.timeClear,"on-ok":t.timeOk}}),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.date.timeFlag,expression:"!date.timeFlag"}],staticClass:"tip"},[e("Tooltip",{attrs:{content:"最多只能选择30天的数据",placement:"bottom-start"}},[e("span",[e("Icon",{attrs:{type:"help-circled"}})],1)])],1)],1)])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.weeklyHigh,expression:"weeklyHigh"}],staticClass:"form-condition"},[e("div",{staticClass:"form-group week-select i-pull-clear"},[e("Select",{staticClass:"i-pull-left",attrs:{filterable:"",placeholder:"请选择周"},on:{"on-change":t.changeData},model:{value:t.week.option,callback:function(a){t.$set(t.week,"option",a)},expression:"week.option"}},t._l(t.week.optionData,function(a){return e("Option",{key:a.label,attrs:{value:a.value}},[t._v(t._s(a.label))])})),t._v(" "),e("div",{staticClass:"i-pull-left tip"},[e("Tooltip",{attrs:{content:"默认显示上一周，最多显示52周",placement:"bottom-start"}},[e("span",[e("Icon",{attrs:{type:"help-circled"}})],1)])],1)],1)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.monthlyHigh,expression:"monthlyHigh"}],staticClass:"form-condition"},[e("div",{staticClass:"form-group "},[e("Date-picker",{staticStyle:{width:"200px"},attrs:{type:"month",placeholder:"选择月",options:t.date.dateValue,value:t.month.monthDate},on:{"on-change":t.monthChange}})],1)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.yearlyHigh,expression:"yearlyHigh"}],staticClass:"form-condition"},[e("div",{staticClass:"form-group "},[e("Date-picker",{staticStyle:{width:"200px"},attrs:{type:"year",value:t.date.year,placeholder:"选择年"},on:{"on-change":t.yearTime}})],1)])])])]),t._v(" "),e("div",{staticClass:"sale-data title-box"},[t._m(0),t._v(" "),e("div",{staticClass:"box-content"},[e("div",{staticClass:"chart-bg"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.noData,expression:"noData"}],staticClass:"chart",attrs:{id:"line"}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.noData,expression:"!noData"}],staticClass:"no-data"},[t._v("暂无数据")])]),t._v(" "),e("div",{staticClass:"export"},[e("a",{staticClass:"i-pull-right",attrs:{href:"javascript:;"},on:{click:t.downLoad}},[t._v("下载报表")])]),t._v(" "),e("div",{staticClass:"table box-bot"},[e("Table",{attrs:{border:"",stripe:"",columns:t.columns,"no-data-text":t.noDataInfo,data:t.dataTable},on:{"on-sort-change":t.sort}}),t._v(" "),e("div",{staticClass:"i-pull-right page"},[e("Page",{attrs:{current:t.page.currPage,size:"small",total:t.page.totalPage,"show-elevator":"","page-size":t.page.pageSize,placement:t.page.direction,"show-sizer":"","show-total":"","page-size-opts":t.page.pageBranch},on:{"on-change":function(a){t.changePage(a)},"on-page-size-change":function(a){t.changeSize(a)}}})],1)],1)])]),t._v(" "),e("Back-top",{attrs:{bottom:150}})],1)},s=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"title"},[e("div",{staticClass:"form-condition self-btn-ghost",attrs:{id:"target-btn"}},[e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost ivu-btn-primary",attrs:{type:"button"}},[e("span",[t._v("订单数")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[e("span",[t._v("销售金额")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[e("span",[t._v("退货数")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[e("span",[t._v("退货金额")])])]),t._v(" "),e("div",{staticClass:"form-group"},[e("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[e("span",[t._v("平均消费价格")])])])])])}],n={render:i,staticRenderFns:s};a.a=n},IgnL:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i;a.default={data:function(){return{villageName:decodeURI(this.$route.query.villageName),dailyHigh:!0,weeklyHigh:!1,monthlyHigh:!1,yearlyHigh:!1,dateType:"day",noDataInfo:"",params:{},initialization:!0,firstLoad:!1,open:!1,date:{picker:"fasdf",openFlag:!0,timeFlag:!0,seven:!0,thirty:!1,zero:!1,day:null,saveDay:null,startTime:comUtils.initDate(7).startTime,endTime:comUtils.initDate(7).endTime,dateValue:{disabledDate:function(t){return t&&t.valueOf()>Date.now()-864e5||t.valueOf()>Date.now()+2592e6}},year:""},noData:!0,week:{option:null,optionData:[]},month:{monthDate:"",optionValue:{disabledDate:function(t){return t&&t.valueOf()>t.valueOf()>Date.now()+2592e6}}},lineAxis:["订单数"],columns:[],dataTable:[],dataName:{"品类":"name1","订单数":"gome_sale_count","销售金额":"gome_sale","退货数":"gome_refund_count","退货金额":"gome_refund","平均消费价格":"avg_price"},page:{currPage:1,pageSize:10,pageBranch:[10,20,50,100],totalPage:0,direction:"top"},getPage:!0,order:{orderColumn:"gome_sale_count",orderType:"desc",orderData:"desc"},analysisType:this.$route.query.analysisType,id:this.$route.query.id}},computed:{monthValue:function(){var t=new Date;t.setMonth(t.getMonth()-1);var a=t.getFullYear(),e=t.getMonth()+1;return a+"-"+(e<10?"0":"")+e}},methods:{getWeekData:function(){var t,a=this,e={},i=[];axios.get(getUrl("dateWeek"),{params:{analysisType:this.analysisType,communityId:this.id,dateType:"week"}}).then(function(s){s.week&&s.week.length>0?(t=s.week,t.reverse(),t.forEach(function(t,a){e={},e.value=t,e.label=t.replace("-","."),i.push(e)}),a.week.optionData=i,a.week.option=i[0].value):(a.week.option="",a.week.optionData=[])}).catch(function(t){})},daily:function(t){switch(t){case"day":this.dailyHigh=!0,this.dateType="day",this.weeklyHigh=this.monthlyHigh=this.yearlyHigh=!1,this.date.seven?this.timeChange(7,!0):this.date.thirty?this.timeChange(30,!0):(this.timeChange(0),this.date.startTime=this.date.saveDay,this.noData=!1);break;case"week":this.weeklyHigh=!0,this.dateType="week",this.date.startTime=this.week.option,this.dailyHigh=this.monthlyHigh=this.yearlyHigh=!1;break;case"month":this.monthlyHigh=!0,this.dateType="month",this.dailyHigh=this.weeklyHigh=this.yearlyHigh=!1,this.date.startTime=this.month.monthDate;break;case"year":this.yearlyHigh=!0,this.dateType="year",this.date.startTime=this.date.year,this.dailyHigh=this.weeklyHigh=this.monthlyHigh=!1}this.page.currPage=1,this.getAllData()},timeChange:function(t,a){7==t?(this.date.seven=this.date.timeFlag=!0,this.date.thirty=this.date.zero=!1,this.date.startTime=comUtils.initDate(7).startTime,this.date.endTime=comUtils.initDate(7).endTime,a||(this.page.currPage=1,this.getAllData())):30==t?(this.date.thirty=this.date.timeFlag=!0,this.date.seven=this.date.zero=!1,this.date.startTime=comUtils.initDate(30).startTime,this.date.endTime=comUtils.initDate(30).endTime,a||(this.page.currPage=1,this.getAllData())):(this.date.zero=!0,this.date.seven=this.date.thirty=this.date.timeFlag=!1)},getTableData:function(){this.open=!1;var t=$("#tip-date .ivu-picker-confirm .dy");t.length>0&&""!=t.html()&&($("#tip-date .ivu-picker-confirm .dy").html(""),$(".ivu-btn.ivu-btn-text.ivu-btn-small").click());var a,e,i=this;i.params={analysisType:this.analysisType,communityId:this.id,dateType:this.dateType,startTime:this.date.startTime,endTime:this.date.endTime,orderColumn:this.order.orderColumn,ordertype:"normal"==this.order.orderType?"desc":this.order.orderType,currPage:this.page.currPage,pageSize:this.page.pageSize},i.noDataInfo="",axios.get(getUrl("classTable"),{params:i.params,loading:!0,unload:!0}).then(function(t){t.CommunityAnalysis&&t.CommunityAnalysis.tableList.length>0?(a=t.CommunityAnalysis,i.page.totalPage=a.totalCount,e=a.tableList,i.requestTableData(e),i.initialization&&($("#category .ivu-table-header thead .ivu-table-cell").each(function(){var t=$(this).find("span:eq(0)");t.replaceWith("<i>"+t.text()+"</i>")}),$("#category .sort-name .ivu-table-sort").find(".ivu-icon-arrow-down-b").addClass("on"),i.initialization=!1)):(i.dataTable=[],i.page.totalPage=0,i.noDataInfo="暂无数据")}).catch(function(t){i.noData=!1,i.dataTable=[],i.page.totalPage=0,i.noDataInfo=t.msg})},getChartData:function(){var t,a,e=this;e.params={analysisType:this.analysisType,communityId:this.id,dateType:this.dateType,startTime:this.date.startTime,endTime:this.date.endTime,currPage:1,pageSize:10},axios.get(getUrl("classChart"),{params:e.params}).then(function(s){s.CommunityAnalysis&&s.CommunityAnalysis.chart&&s.CommunityAnalysis.chart.gome_sale?(e.noData=!0,t=s.CommunityAnalysis,a=i=t.chart,e.chartData(a)):e.noData=!1}).catch(function(t){e.noData=!1})},getAllData:function(){this.getTableData(),this.getChartData()},requestTableData:function(t){var a,e,i={},s=[],n=this.columns;t.forEach(function(t,o){i={};for(var r in n)"gome_sale"==n[r].key||"gome_refund"==n[r].key||"avg_price"==n[r].key?0==t[n[r].key]?i[n[r].key]=t[n[r].key]:(a=parseFloat(t[n[r].key]).toFixed(2).split("."),e=comUtils.toThousands(a[0]),i[n[r].key]=e+"."+a[1]):"name1"==n[r].key?i[n[r].key]=t[n[r].key].split(" ")[0]:i[n[r].key]=comUtils.toThousands(t[n[r].key]);s.push(i)}),this.dataTable=s},chartData:function(t){for(var a in t)"gome_sale"!=a&&"gome_refund"!=a&&"avg_price"!=a||(t[a]=t[a].map(function(t,a){return t>0?parseFloat(t).toFixed(2):t}));var e,i=this,s=["#4b5054"],n={},o=[],r=[],l=[],d=[];l=i.lineAxis;for(var h in t)i.dataName[l[0]]===h&&(n={},n.name=l[0],n.type="bar",n.barWidth="15%",n.data=t[h],n.itemStyle={normal:{color:s[0],lineStyle:{color:s[0]}}},d.push(n)),h.indexOf(i.dataName[l[0]])>0&&(o=t[h]);if(r=[{type:"value",splitLine:{show:!1}}],1==d.length&&0==d[0].data.length||2==d.length&&0==d[0].data.length&&0==d[0].data.length)return void(i.noData=!1);i.noData=!0,e={color:["#2f4554"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:l},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:o,axisTick:{alignWithLabel:!0}}],yAxis:r,series:d};var c,u=Echarts.init(document.getElementById("line"));u.setOption(e,!0),window.onresize=function(){c=$(".chart-bg").width(),$("#line").css("width",c),u.resize()}},dateTime:function(t){var a=/\./g,e=new Date(t[0].replace(a,"-")).getTime(),i=new Date(t[1].replace(a,"-")).getTime(),s=$("#tip-date .ivu-picker-confirm"),n=$("#tip-date .ivu-picker-confirm .dy").length;i-e+864e5>2592e6?(this.date.openFlag=!1,n>0?s.find(".dy").html("最多只能选择30天的数据"):s.prepend('<div class="dy">最多只能选择30天的数据</div>'),s.find(".ivu-btn-primary").attr("disabled",!0)):(this.date.openFlag=!0,this.date.startTime=this.date.saveDay=t[0],this.date.endTime=t[1],n>0&&$("#tip-date .ivu-picker-confirm .dy").html(""),s.find(".ivu-btn-primary").attr("disabled",!1))},timeOk:function(){this.date.openFlag&&(this.open=!1,this.getAllData())},timeClear:function(){$("#tip-date .ivu-picker-confirm .dy").length>0&&$("#tip-date .ivu-picker-confirm .dy").html(""),this.open=!1},yearTime:function(t){this.date.startTime=this.date.year=t,this.getAllData()},monthChange:function(t){this.date.startTime=this.month.monthDate=t,this.getAllData()},changeData:function(t){this.firstLoad?(this.date.startTime=t,this.getAllData()):this.firstLoad=!0},warning:function(t){this.$Message.warning(t)},back:function(){this.$store.state.path="main",this.$router.push("/dataAnalysis/dataAnalysis.html")},changePage:function(t){this.page.currPage=t,this.getPage?this.getTableData():this.getPage=!0},changeSize:function(t){this.page.pageSize=t,this.page.currPage=1,this.getTableData(),this.getPage=!1},downLoad:function(){var t=getUrl("download_class");t+="?analysisType="+this.analysisType+"&communityId="+this.id+"&dateType="+this.dateType+"&startTime="+this.date.startTime+"&endTime="+this.date.endTime+"&orderColumn="+this.order.orderColumn+"&ordertype="+this.order.orderType,window.location.href=t},sort:function(t){var a;this.order.orderColumn=a=t.key,"normal"!=t.order&&(this.order.orderData=t.order),$("#category .ivu-table-sort").find(".ivu-icon").removeClass("on"),"desc"==this.order.orderData?setTimeout(function(){$("."+a).find(".ivu-icon-arrow-down-b").addClass("on")},50):setTimeout(function(){$("."+a).find(".ivu-icon-arrow-up-b").addClass("on")},50),this.order.orderType=this.order.orderData,this.getTableData()},handleClick:function(t){this.date.timeFlag||($("#tip-date .ivu-picker-confirm .ivu-btn-text").find("span:eq(0)").html("取消"),this.open=!0)}},mounted:function(){var t=new Date,a=t.getFullYear().toString();this.date.year=a;var e,s=this,n={},o=$(".chart-bg").width();this.month.monthDate=this.monthValue;for(var r in s.dataName){switch(n={},n.title=r,n.key=s.dataName[r],n.className="订单数"==r?"sort-name "+s.dataName[r]:s.dataName[r],"品类"!=r&&(n.sortable="custom"),r){case"订单数":comUtils.help(n,"订单数","所选时间范围内，该小区（楼盘）某个品类产生的零售单数量");break;case"销售金额":comUtils.help(n,"销售金额","所选时间范围内，该小区（楼盘）某个品类的销售金额总和");break;case"退货数":comUtils.help(n,"退货数","所选时间范围内，该小区（楼盘）某个品类产生的退货零售单数量");break;case"退货金额":comUtils.help(n,"退货金额","所选时间范围内，该小区（楼盘）某个品类退货零售单中销售金额之和");break;case"平均消费价格":comUtils.help(n,"平均消费价格","所选时间范围内，该小区（楼盘）某个品类销售金额/商品数")}s.columns.push(n)}$("#target-btn button").each(function(){$(this).on("click",function(){if($(this).hasClass("ivu-btn-primary"))return void s.warning("至少勾选一个指标");s.lineAxis=[],e=$(this).find("span").text(),$("#target-btn button").removeClass("ivu-btn-primary"),$(this).addClass("ivu-btn-primary"),s.lineAxis.push(e),s.chartData(i)})}),$("#line").css("width",o),this.getWeekData(),this.getAllData(),$("#picker .ivu-input-wrapper").on("click",function(){s.handleClick()})}}},Uvdc:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("IgnL"),s=e.n(i);for(var n in i)"default"!==n&&function(t){e.d(a,t,function(){return i[t]})}(n);var o=e("Hv9Z"),r=e("VU/8"),l=r(s.a,o.a,!1,null,null,null);a.default=l.exports}});
//# sourceMappingURL=21.e1df1772de85a68ae6e1.js.map