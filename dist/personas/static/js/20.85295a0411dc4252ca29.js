webpackJsonp([20],{"2MzW":function(t,a,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=i("RfpW"),s=i.n(e);for(var n in e)"default"!==n&&function(t){i.d(a,t,function(){return e[t]})}(n);var o=i("ClVE"),l=i("VU/8"),r=l(s.a,o.a,!1,null,null,null);a.default=r.exports},ClVE:function(t,a,i){"use strict";var e=function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"sale-situation",attrs:{id:"sale-situation"}},[i("div",{staticClass:"sale-top box-bot title-box"},[i("div",{staticClass:"title i-pull-clear"},[i("div",{staticClass:"i-pull-left"},[i("span",{staticClass:"title-name",domProps:{textContent:t._s(t.villageName)}})]),t._v(" "),i("div",{staticClass:"i-pull-right btn-right"},[i("Button",{attrs:{type:"primary"},on:{click:t.back}},[t._v("返回数据分析列表")])],1)]),t._v(" "),i("div",{staticClass:"box-content sale-form"},[i("div",{staticClass:"form-condition self-btn-ghost",attrs:{id:"form-btn"}},[i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.dailyHigh},attrs:{type:"button"},on:{click:function(a){t.daily("day")}}},[i("span",[t._v("日报")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.weeklyHigh},attrs:{type:"button"},on:{click:function(a){t.daily("week")}}},[i("span",[t._v("周报")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.monthlyHigh},attrs:{type:"button"},on:{click:function(a){t.daily("month")}}},[i("span",[t._v("月报")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.yearlyHigh},attrs:{type:"button"},on:{click:function(a){t.daily("year")}}},[i("span",[t._v("年报")])])])]),t._v(" "),i("div",{staticClass:"date-component"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.dailyHigh,expression:"dailyHigh"}],staticClass:"daily form-condition self-btn-ghost  "},[i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.date.seven},attrs:{type:"button"},on:{click:function(a){t.timeChange("7")}}},[i("span",[t._v("最近7天")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.date.thirty},attrs:{type:"button"},on:{click:function(a){t.timeChange("30")}}},[i("span",[t._v("最近30天")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",class:{"ivu-btn-primary":t.date.zero},attrs:{type:"button"},on:{click:function(a){t.timeChange()}}},[i("span",[t._v("自定义时段")])])]),t._v(" "),i("div",{staticClass:"form-group",attrs:{id:"tip-date"}},[i("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"daterange",format:"yyyy.MM.dd",confirm:"",value:t.date.day,disabled:t.date.timeFlag,open:t.open,options:t.date.dateValue,placement:"bottom-start",placeholder:"选择日期",id:"picker"},on:{"on-change":t.dateTime,"on-ok":t.timeOk,"on-clear":t.timeClear}}),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.date.timeFlag,expression:"!date.timeFlag"}],staticClass:"tip"},[i("Tooltip",{attrs:{content:"最多只能选择30天的数据",placement:"bottom-start"}},[i("span",[i("Icon",{attrs:{type:"help-circled"}})],1)])],1)],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.monthlyHigh,expression:"monthlyHigh"}],staticClass:"form-condition"},[i("div",{staticClass:"form-group monthly-report"},[i("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"year",value:t.date.year,placeholder:"选择年"},on:{"on-change":t.yearTime}})],1)])])])]),t._v(" "),i("div",{staticClass:"sale-data title-box"},[t._m(0),t._v(" "),i("div",{staticClass:"box-content"},[i("div",{staticClass:"chart-bg"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.noData,expression:"noData"}],staticClass:"chart",attrs:{id:"line"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.noData,expression:"!noData"}],staticClass:"no-data"},[t._v("暂无数据")])]),t._v(" "),i("div",{staticClass:"export"},[i("a",{staticClass:"i-pull-right",attrs:{href:"javascript:;"},on:{click:t.downLoad}},[t._v("下载报表")])]),t._v(" "),i("div",{staticClass:"table todo-table"},[i("Table",{attrs:{border:"",stripe:"",columns:t.columns,"no-data-text":t.noDataInfo,data:t.dataTable}})],1)])]),t._v(" "),i("Back-top",{attrs:{bottom:110}})],1)},s=[function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"title"},[i("div",{staticClass:"form-condition self-btn-ghost",attrs:{id:"target-btn"}},[i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost ivu-btn-primary",attrs:{type:"button"}},[i("span",[t._v("订单数")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost ivu-btn-primary",attrs:{type:"button"}},[i("span",[t._v("销售金额")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[i("span",[t._v("退货数")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[i("span",[t._v("退货金额")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[i("span",[t._v("品类数")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[i("span",[t._v("品牌数")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[i("span",[t._v("商品数")])])]),t._v(" "),i("div",{staticClass:"form-group"},[i("button",{staticClass:"ivu-btn ivu-btn-ghost",attrs:{type:"button"}},[i("span",[t._v("平均订单价格")])])])])])}],n={render:e,staticRenderFns:s};a.a=n},RfpW:function(t,a,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e,s=new Date,n=s.getFullYear().toString();a.default={data:function(){return{villageName:decodeURI(this.$route.query.villageName),dailyHigh:!0,weeklyHigh:!1,monthlyHigh:!1,yearlyHigh:!1,dateType:"day",noDataInfo:"",params:{},open:!1,date:{openFlag:!0,timeFlag:!0,seven:!0,thirty:!1,zero:!1,day:null,saveDay:null,startTime:comUtils.initDate(7).startTime,endTime:comUtils.initDate(7).endTime,dateValue:{shortcuts:[],disabledDate:function(t){return t&&t.valueOf()>Date.now()-864e5||t.valueOf()>Date.now()+2592e6}},year:""},noData:!0,lineAxis:["订单数","销售金额"],columns:[],dataTable:[],dataName:{"日期":"tdate","订单数":"gome_sale_count","销售金额":"gome_sale","退货数":"gome_refund_count","退货金额":"gome_refund","品类数":"class1_count","品牌数":"prdha_count","商品数":"gome_sp_count","平均订单价格":"avg_price"},analysisType:this.$route.query.analysisType,id:this.$route.query.id}},computed:{defaultDay:function(){var t=comUtils.getDefaultTime(7);return[t.start,t.end]}},methods:{daily:function(t){switch(t){case"day":this.dailyHigh=!0,this.dateType="day",this.weeklyHigh=this.monthlyHigh=this.yearlyHigh=!1,this.date.seven?this.timeChange(7,!0):this.date.thirty?this.timeChange(30,!0):(this.timeChange(0),this.date.startTime=this.date.saveDay,this.noData=!1);break;case"week":this.weeklyHigh=!0,this.dateType="week",this.dailyHigh=this.monthlyHigh=this.yearlyHigh=!1;break;case"month":this.monthlyHigh=!0,this.dateType="month",this.date.startTime=this.date.year,this.dailyHigh=this.weeklyHigh=this.yearlyHigh=!1;break;case"year":this.yearlyHigh=!0,this.dateType="year",this.dailyHigh=this.weeklyHigh=this.monthlyHigh=!1}this.getAllData()},timeChange:function(t,a){7==t?(this.date.seven=this.date.timeFlag=!0,this.date.thirty=this.date.zero=!1,this.date.startTime=comUtils.initDate(7).startTime,this.date.endTime=comUtils.initDate(7).endTime,a||this.getAllData()):30==t?(this.date.thirty=this.date.timeFlag=!0,this.date.seven=this.date.zero=!1,this.date.startTime=comUtils.initDate(30).startTime,this.date.endTime=comUtils.initDate(30).endTime,a||this.getAllData()):(this.date.zero=!0,this.date.seven=this.date.thirty=this.date.timeFlag=!1)},getTableData:function(){var t,a,i=this;i.params.dateType=i.dateType,i.params.startTime=i.date.startTime,i.params.endTime=i.date.endTime,i.noDataInfo="",i.open=!1;var e=$("#tip-date .ivu-picker-confirm .dy");e.length>0&&""!=e.html()&&($("#tip-date .ivu-picker-confirm .dy").html(""),$(".ivu-btn.ivu-btn-text.ivu-btn-small").click()),axios.get(getUrl("saleTable"),{params:i.params}).then(function(e){e.CommunityAnalysis&&e.CommunityAnalysis.tableList.length>0?(t=e.CommunityAnalysis,a=t.tableList,i.requestTableData(a)):(i.dataTable=[],i.noDataInfo="暂无数据")}).catch(function(t){i.dataTable=[],i.noDataInfo=t.msg})},getChartData:function(){var t,a,i=this;i.params.dateType=i.dateType,i.params.startTime=i.date.startTime,i.params.endTime=i.date.endTime,axios.get(getUrl("saleChart"),{params:i.params,loading:!0,unload:!0}).then(function(s){s.CommunityAnalysis&&s.CommunityAnalysis.chart&&s.CommunityAnalysis.chart.xAxis.length>0?(i.noData=!0,t=s.CommunityAnalysis,a=e=t.chart,i.chartData(a)):i.noData=!1}).catch(function(t){i.noData=!1})},getAllData:function(){this.getTableData(),this.getChartData()},requestTableData:function(t){var a,i,e={},s=[],n=this.columns;t.forEach(function(t,o){e={};for(var l in n)"gome_sale"==n[l].key||"gome_refund"==n[l].key||"avg_price"==n[l].key?0==t[n[l].key]?e[n[l].key]=t[n[l].key]:(a=parseFloat(t[n[l].key]).toFixed(2).split("."),i=comUtils.toThousands(a[0]),e[n[l].key]=i+"."+a[1]):"tdate"==n[l].key?e[n[l].key]=t[n[l].key].split(" ")[0]:e[n[l].key]=comUtils.toThousands(t[n[l].key]);s.push(e)}),this.dataTable=s},chartData:function(t){if(t&&t.xAxis&&t.xAxis.length>0){for(var a in t)"gome_sale"!=a&&"gome_refund"!=a&&"avg_price"!=a||(t[a]=t[a].map(function(t,a){return t>0?parseFloat(t).toFixed(2):t}));var i,e=this,s=["#c23531","#2f4554"],n={},o=t.xAxis,l=[],r=[],c=[];r=e.lineAxis,l=[{type:"value",name:r[0],axisLine:{show:!0}}],r.forEach(function(a,i){for(var o in t)if(e.dataName[a]===o){n={},n.name=a,n.type="line",n.data=t[o],n.itemStyle={normal:{color:s[i],lineStyle:{color:s[i]}}},c.push(n);break}}),2==r.length&&(l.push({type:"value",name:r[1],splitLine:{show:!1}}),c[1].yAxisIndex=1),i={title:{x:"center",y:20},tooltip:{trigger:"axis"},legend:{data:r},grid:{top:"15%",left:"5%",right:"4%",bottom:"1%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:o,axisLine:{lineStyle:{color:"#333"}},axisLabel:{show:!0,textStyle:{color:"#333"}}}],yAxis:l,series:c};var d,h=Echarts.init(document.getElementById("line"));h.setOption(i,!0),window.onresize=function(){d=$(".chart-bg").width(),$("#line").css("width",d),h.resize()}}},dateTime:function(t){var a=/\./g,i=new Date(t[0].replace(a,"-")).getTime(),e=new Date(t[1].replace(a,"-")).getTime(),s=$("#tip-date .ivu-picker-confirm"),n=$("#tip-date .ivu-picker-confirm .dy").length;e-i+864e5>2592e6?(this.date.openFlag=!1,n>0?s.find(".dy").html("最多只能选择30天的数据"):s.prepend('<div class="dy">最多只能选择30天的数据</div>'),s.find(".ivu-btn-primary").attr("disabled",!0)):(this.date.openFlag=!0,this.date.startTime=this.date.saveDay=t[0],this.date.endTime=t[1],n>0&&$("#tip-date .ivu-picker-confirm .dy").html(""),s.find(".ivu-btn-primary").attr("disabled",!1))},timeOk:function(){this.date.openFlag&&(this.open=!1,this.getAllData())},timeClear:function(){$("#tip-date .ivu-picker-confirm .dy").length>0&&$("#tip-date .ivu-picker-confirm .dy").html(""),this.open=!1},yearTime:function(t){this.date.startTime=this.date.year=t,this.getAllData()},warning:function(t){this.$Message.warning(t)},back:function(){this.$store.state.path="main",this.$router.push("/dataAnalysis/dataAnalysis.html")},downLoad:function(){var t=getUrl("download_sale");t+="?analysisType="+this.analysisType+"&communityId="+this.id+"&dateType="+this.dateType+"&startTime="+this.date.startTime+"&endTime="+this.date.endTime,window.location.href=t},handleClick:function(t){this.date.timeFlag||($("#tip-date .ivu-picker-confirm .ivu-btn-text").find("span").html("取消"),this.open=!0)}},mounted:function(){this.date.year=n;var t,a,i=this,s={},o=$(".chart-bg").width();i.params={analysisType:this.analysisType,communityId:this.id};for(var l in i.dataName){switch(s={},s.title=l,s.key=i.dataName[l],"日期"==l&&(s.className="tdate"),l){case"订单数":comUtils.help(s,"订单数","所选时间范围内，该小区（楼盘）产生的零售单数量");break;case"销售金额":comUtils.help(s,"销售金额","所选时间范围内，该小区（楼盘）零售单中销售金额之和");break;case"退货数":comUtils.help(s,"退货数","所选时间范围内，该小区（楼盘）产生的零售单类型为“退货”的零售单数量");break;case"退货金额":comUtils.help(s,"退货金额","所选时间范围内，该小区（楼盘）产生的零售单类型为“退货”的零售单中销售金额之和");break;case"品类数":comUtils.help(s,"品类数","所选时间范围内，该小区（楼盘）销售的品类数量之和");break;case"品牌数":comUtils.help(s,"品牌数","所选时间范围内，该小区（楼盘）销售的品牌数量之和");break;case"商品数":comUtils.help(s,"商品数","所选时间范围内，该小区（楼盘）销售的商品数量之和");break;case"平均订单价格":comUtils.help(s,"平均订单价格","所选时间范围内，该小区（楼盘）销售金额总和/订单数")}i.columns.push(s)}$("#target-btn button").each(function(){$(this).on("click",function(){if(t=$("#target-btn button.ivu-btn-primary").length,a=$(this).find("span").text(),$(this).hasClass("ivu-btn-primary")){if(1==t)return void i.warning("至少勾选一个指标");if(i.$Message.destroy(),$(this).removeClass("ivu-btn-primary"),i.lineAxis.length>0)for(var s=0,n=i.lineAxis.length;s<n;s++)if(a==i.lineAxis[s]){i.lineAxis.splice(s,1);break}}else{if(t>=2)return void i.warning("最多勾选两个指标");i.$Message.destroy(),$(this).addClass("ivu-btn-primary"),i.lineAxis.push(a)}i.chartData(e)})}),$("#line").css("width",o),this.getAllData(),$("#picker .ivu-input-wrapper").on("click",function(){i.handleClick()})}}}});
//# sourceMappingURL=20.85295a0411dc4252ca29.js.map